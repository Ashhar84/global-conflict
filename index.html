<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Conflict - Nation Selection</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        :root {
            --primary-bg: #1a1a1a; --secondary-bg: #2c2c2c; --tertiary-bg: #3a3a3a;
            --border-color: #4a4a4a; --text-color: #e0e0e0; --accent-color: #00aaff;
            --accent-hover: #0077cc; --capital-color: #ffd700; --header-bg: #0f4c5c;
            --success-color: #2ecc71; --danger-color: #ff4d4d; --warning-color: #f1c40f;
        }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--primary-bg); color: var(--text-color); }
        
        #game-container { display: flex; flex-direction: column; height: 100%; }
        
        #selection-bar { background: var(--header-bg); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1001; box-shadow: 0 2px 10px rgba(0,0,0,0.5); position: fixed; width: 100%; top: 0; left: 0; box-sizing: border-box; }
        #selection-ui { display: flex; align-items: center; gap: 20px; font-size: 1.2em; color: var(--text-color); }
        .selection-action-button { background-color: var(--accent-color); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .selection-action-button:hover:not(:disabled) { background-color: var(--accent-hover); }
        .selection-action-button:disabled { background-color: var(--tertiary-bg); cursor: not-allowed; opacity: 0.7; }
        
        #main-content { flex-grow: 1; display: flex; position: relative; padding-top: 60px; box-sizing: border-box; }
        #map-container { position: absolute; top: 60px; left: 0; right: 0; bottom: 0; background-color: #0d1b2a; cursor: pointer; z-index: 1; }
        .leaflet-grab { cursor: grab; }
        .leaflet-grabbing { cursor: grabbing; }
        
        .selection-instructions { position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; text-align: center; font-size: 0.9em; pointer-events: none; }
        .country-tooltip { background: rgba(0, 0, 0, 0.7); border: 1px solid var(--accent-color); border-radius: 4px; color: white; padding: 4px 8px; font-size: 14px; pointer-events: none; }
        
        #nation-details-panel { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(15, 76, 92, 0.9); padding: 15px; border-radius: 10px; z-index: 1000; max-width: 80%; text-align: center; backdrop-filter: blur(5px); border: 1px solid var(--border-color); display: none; }
        #nation-details-name { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
        #nation-details-flag { font-size: 2em; margin-bottom: 10px; }
        #nation-details-stats { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .nation-stat { background-color: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px; }
        
        .loading-spinner { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.1); border-radius: 50%; border-top-color: var(--accent-color); animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20000;
        }
        .modal-content {
            background-color: var(--secondary-bg);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-width: 90%;
            width: 400px;
        }
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .modal-button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .modal-confirm { background-color: var(--accent-color); color: white; }
        .modal-cancel { background-color: var(--tertiary-bg); color: var(--text-color); }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="selection-bar">
            <div id="selection-ui">
                <span>Select Nation: <strong id="selected-nation-display">None</strong></span>
                <button id="start-game-btn" class="selection-action-button" disabled>Start Game</button>
            </div>
        </div>
        
        <div id="main-content">
            <div id="map-container"></div>
            <div class="selection-instructions" id="selection-instructions">Click on any country to select your nation</div>
            
            <div id="nation-details-panel">
                <div id="nation-details-flag"></div>
                <div id="nation-details-name"></div>
                <div id="nation-details-stats">
                    <div class="nation-stat" id="nation-details-population"></div>
                    <div class="nation-stat" id="nation-details-gdp"></div>
                    <div class="nation-stat" id="nation-details-military"></div>
                </div>
            </div>
        </div>
        
        <div class="loading-spinner" id="loading-spinner">
            <div class="spinner"></div>
            <div>Loading world map...</div>
        </div>

        <div class="modal-overlay" id="custom-modal">
            <div class="modal-content">
                <p id="modal-text" style="white-space: pre-wrap;"></p>
                <div class="modal-buttons" id="modal-buttons">
                    <!-- Buttons are dynamically injected here -->
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Comprehensive list of country flags and colors
        const NATION_FLAGS = {
            "Afghanistan": "ðŸ‡¦ðŸ‡«", "Albania": "ðŸ‡¦ðŸ‡±", "Algeria": "ðŸ‡©ðŸ‡¿", "Andorra": "ðŸ‡¦ðŸ‡©", "Angola": "ðŸ‡¦ðŸ‡´",
            "Antigua and Barbuda": "ðŸ‡¦ðŸ‡¬", "Argentina": "ðŸ‡¦ðŸ‡·", "Armenia": "ðŸ‡¦ðŸ‡²", "Australia": "ðŸ‡¦ðŸ‡º", "Austria": "ðŸ‡¦ðŸ‡¹",
            "Azerbaijan": "ðŸ‡¦ðŸ‡¿", "Bahamas": "ðŸ‡§ðŸ‡¸", "Bahrain": "ðŸ‡§ðŸ‡­", "Bangladesh": "ðŸ‡§ðŸ‡©", "Barbados": "ðŸ‡§ðŸ‡§",
            "Belarus": "ðŸ‡§ðŸ‡¾", "Belgium": "ðŸ‡§ðŸ‡ª", "Belize": "ðŸ‡§ðŸ‡¿", "Benin": "ðŸ‡§ðŸ‡¯", "Bhutan": "ðŸ‡§ðŸ‡¹",
            "Bolivia": "ðŸ‡§ðŸ‡´", "Bosnia and Herzegovina": "ðŸ‡§ðŸ‡¦", "Botswana": "ðŸ‡§ðŸ‡¼", "Brazil": "ðŸ‡§ðŸ‡·", "Brunei": "ðŸ‡§ðŸ‡³",
            "Bulgaria": "ðŸ‡§ðŸ‡¬", "Burkina Faso": "ðŸ‡§ðŸ‡«", "Burundi": "ðŸ‡§ðŸ‡®", "CÃ´te d'Ivoire": "ðŸ‡¨ðŸ‡®", "Cabo Verde": "ðŸ‡¨ðŸ‡»",
            "Cambodia": "ðŸ‡°ðŸ‡­", "Cameroon": "ðŸ‡¨ðŸ‡²", "Canada": "ðŸ‡¨ðŸ‡¦", "Central African Republic": "ðŸ‡¨ðŸ‡«", "Chad": "ðŸ‡¹ðŸ‡©",
            "Chile": "ðŸ‡¨ðŸ‡±", "China": "ðŸ‡¨ðŸ‡³", "Colombia": "ðŸ‡¨ðŸ‡´", "Comoros": "ðŸ‡°ðŸ‡²", "Congo (Congo-Brazzaville)": "ðŸ‡¨ðŸ‡¬",
            "Costa Rica": "ðŸ‡¨ðŸ‡·", "Croatia": "ðŸ‡­ðŸ‡·", "Cuba": "ðŸ‡¨ðŸ‡º", "Cyprus": "ðŸ‡¨ðŸ‡¾", "Czechia (Czech Republic)": "ðŸ‡¨ðŸ‡¿",
            "Democratic Republic of the Congo": "ðŸ‡¨ðŸ‡©", "Denmark": "ðŸ‡©ðŸ‡°", "Djibouti": "ðŸ‡©ðŸ‡¯", "Dominica": "ðŸ‡©ðŸ‡²", "Dominican Republic": "ðŸ‡©ðŸ‡´",
            "Ecuador": "ðŸ‡ªðŸ‡¨", "Egypt": "ðŸ‡ªðŸ‡¬", "El Salvador": "ðŸ‡¸ðŸ‡»", "Equatorial Guinea": "ðŸ‡¬ðŸ‡¶", "Eritrea": "ðŸ‡ªðŸ‡·",
            "Estonia": "ðŸ‡ªðŸ‡ª", "Eswatini": "ðŸ‡¸ðŸ‡¿", "Ethiopia": "ðŸ‡ªðŸ‡¹", "Fiji": "ðŸ‡«ðŸ‡¯", "Finland": "ðŸ‡«ðŸ‡®",
            "France": "ðŸ‡«ðŸ‡·", "Gabon": "ðŸ‡¬ðŸ‡¦", "Gambia": "ðŸ‡¬ðŸ‡²", "Georgia": "ðŸ‡¬ðŸ‡ª", "Germany": "ðŸ‡©ðŸ‡ª",
            "Ghana": "ðŸ‡¬ðŸ‡­", "Greece": "ðŸ‡¬ðŸ‡·", "Grenada": "ðŸ‡¬ðŸ‡©", "Guatemala": "ðŸ‡¬ðŸ‡¹", "Guinea": "ðŸ‡¬ðŸ‡³",
            "Guinea-Bissau": "ðŸ‡¬ðŸ‡¼", "Guyana": "ðŸ‡¬ðŸ‡¾", "Haiti": "ðŸ‡­ðŸ‡¹", "Holy See": "ðŸ‡»ðŸ‡¦", "Honduras": "ðŸ‡­ðŸ‡³",
            "Hungary": "ðŸ‡­ðŸ‡º", "Iceland": "ðŸ‡®ðŸ‡¸", "India": "ðŸ‡®ðŸ‡³", "Indonesia": "ðŸ‡®ðŸ‡©", "Iran": "ðŸ‡®ðŸ‡·",
            "Iraq": "ðŸ‡®ðŸ‡¶", "Ireland": "ðŸ‡®ðŸ‡ª", "Israel": "ðŸ‡®ðŸ‡±", "Italy": "ðŸ‡®ðŸ‡¹", "Jamaica": "ðŸ‡¯ðŸ‡²",
            "Japan": "ðŸ‡¯ðŸ‡µ", "Jordan": "ðŸ‡¯ðŸ‡´", "Kazakhstan": "ðŸ‡°ðŸ‡¿", "Kenya": "ðŸ‡°ðŸ‡ª", "Kiribati": "ðŸ‡°ðŸ‡®",
            "Kuwait": "ðŸ‡°ðŸ‡¼", "Kyrgyzstan": "ðŸ‡°ðŸ‡¬", "Laos": "ðŸ‡±ðŸ‡¦", "Latvia": "ðŸ‡±ðŸ‡»", "Lebanon": "ðŸ‡±ðŸ‡§",
            "Lesotho": "ðŸ‡±ðŸ‡¸", "Liberia": "ðŸ‡±ðŸ‡·", "Libya": "ðŸ‡±ðŸ‡¾", "Liechtenstein": "ðŸ‡±ðŸ‡®", "Lithuania": "ðŸ‡±ðŸ‡¹",
            "Luxembourg": "ðŸ‡±ðŸ‡º", "Madagascar": "ðŸ‡²ðŸ‡¬", "Malawi": "ðŸ‡²ðŸ‡¼", "Malaysia": "ðŸ‡²ðŸ‡¾", "Maldives": "ðŸ‡²ðŸ‡»",
            "Mali": "ðŸ‡²ðŸ‡±", "Malta": "ðŸ‡²ðŸ‡¹", "Marshall Islands": "ðŸ‡²ðŸ‡­", "Mauritania": "ðŸ‡²ðŸ‡·", "Mauritius": "ðŸ‡²ðŸ‡º",
            "Mexico": "ðŸ‡²ðŸ‡½", "Micronesia": "ðŸ‡«ðŸ‡²", "Moldova": "ðŸ‡²ðŸ‡©", "Monaco": "ðŸ‡²ðŸ‡¨", "Mongolia": "ðŸ‡²ðŸ‡³",
            "Montenegro": "ðŸ‡²ðŸ‡ª", "Morocco": "ðŸ‡²ðŸ‡¦", "Mozambique": "ðŸ‡²ðŸ‡¿", "Myanmar": "ðŸ‡²ðŸ‡²", "Namibia": "ðŸ‡³ðŸ‡¦",
            "Nauru": "ðŸ‡³ðŸ‡·", "Nepal": "ðŸ‡³ðŸ‡µ", "Netherlands": "ðŸ‡³ðŸ‡±", "New Zealand": "ðŸ‡³ðŸ‡¿", "Nicaragua": "ðŸ‡³ðŸ‡®",
            "Niger": "ðŸ‡³ðŸ‡ª", "Nigeria": "ðŸ‡³ðŸ‡¬", "North Korea": "ðŸ‡°ðŸ‡µ", "North Macedonia": "ðŸ‡²ðŸ‡°", "Norway": "ðŸ‡³ðŸ‡´",
            "Oman": "ðŸ‡´ðŸ‡²", "Pakistan": "ðŸ‡µðŸ‡°", "Palau": "ðŸ‡µðŸ‡¼", "Panama": "ðŸ‡µðŸ‡¦", "Papua New Guinea": "ðŸ‡µðŸ‡¬",
            "Paraguay": "ðŸ‡µðŸ‡¾", "Peru": "ðŸ‡µðŸ‡ª", "Philippines": "ðŸ‡µðŸ‡­", "Poland": "ðŸ‡µðŸ‡±", "Portugal": "ðŸ‡µðŸ‡¹",
            "Qatar": "ðŸ‡¶ðŸ‡¦", "Romania": "ðŸ‡·ðŸ‡´", "Russia": "ðŸ‡·ðŸ‡º", "Rwanda": "ðŸ‡·ðŸ‡¼", "Saint Kitts and Nevis": "ðŸ‡°ðŸ‡³",
            "Saint Lucia": "ðŸ‡±ðŸ‡¨", "Saint Vincent and the Grenadines": "ðŸ‡»ðŸ‡¨", "Samoa": "ðŸ‡¼ðŸ‡¸", "San Marino": "ðŸ‡¸ðŸ‡²", "Sao Tome and Principe": "ðŸ‡¸ðŸ‡¹",
            "Saudi Arabia": "ðŸ‡¸ðŸ‡¦", "Senegal": "ðŸ‡¸ðŸ‡³", "Serbia": "ðŸ‡·ðŸ‡¸", "Seychelles": "ðŸ‡¸ðŸ‡¨", "Sierra Leone": "ðŸ‡¸ðŸ‡±",
            "Singapore": "ðŸ‡¸ðŸ‡¬", "Slovakia": "ðŸ‡¸ðŸ‡°", "Slovenia": "ðŸ‡¸ðŸ‡®", "Solomon Islands": "ðŸ‡¸ðŸ‡§", "Somalia": "ðŸ‡¸ðŸ‡´",
            "South Africa": "ðŸ‡¿ðŸ‡¦", "South Korea": "ðŸ‡°ðŸ‡·", "South Sudan": "ðŸ‡¸ðŸ‡¸", "Spain": "ðŸ‡ªðŸ‡¸", "Sri Lanka": "ðŸ‡±ðŸ‡°",
            "Sudan": "ðŸ‡¸ðŸ‡©", "Suriname": "ðŸ‡¸ðŸ‡·", "Sweden": "ðŸ‡¸ðŸ‡ª", "Switzerland": "ðŸ‡¨ðŸ‡­", "Syria": "ðŸ‡¸ðŸ‡¾",
            "Tajikistan": "ðŸ‡¹ðŸ‡¯", "Tanzania": "ðŸ‡¹ðŸ‡¿", "Thailand": "ðŸ‡¹ðŸ‡­", "Timor-Leste": "ðŸ‡¹ðŸ‡±", "Togo": "ðŸ‡¹ðŸ‡¬",
            "Tonga": "ðŸ‡¹ðŸ‡´", "Trinidad and Tobago": "ðŸ‡¹ðŸ‡¹", "Tunisia": "ðŸ‡¹ðŸ‡³", "Turkey": "ðŸ‡¹ðŸ‡·", "Turkmenistan": "ðŸ‡¹ðŸ‡²",
            "Tuvalu": "ðŸ‡¹ðŸ‡»", "Uganda": "ðŸ‡ºðŸ‡¬", "Ukraine": "ðŸ‡ºðŸ‡¦", "United Arab Emirates": "ðŸ‡¦ðŸ‡ª", "United Kingdom": "ðŸ‡¬ðŸ‡§",
            "United States": "ðŸ‡ºðŸ‡¸", "Uruguay": "ðŸ‡ºðŸ‡¾", "Uzbekistan": "ðŸ‡ºðŸ‡¿", "Vanuatu": "ðŸ‡»ðŸ‡º", "Venezuela": "ðŸ‡»ðŸ‡ª",
            "Vietnam": "ðŸ‡»ðŸ‡³", "Yemen": "ðŸ‡¾ðŸ‡ª", "Zambia": "ðŸ‡¿ðŸ‡²", "Zimbabwe": "ðŸ‡¿ðŸ‡¼"
        };

        // National flag colors (primary color from each flag)
        const NATION_COLORS = {
            "Afghanistan": "#000000", "Albania": "#DA291C", "Algeria": "#006233", "Andorra": "#D62612", "Angola": "#CC092F",
            "Antigua and Barbuda": "#000000", "Argentina": "#75AADB", "Armenia": "#D90012", "Australia": "#00008B", "Austria": "#C8102E",
            "Azerbaijan": "#00B5E2", "Bahamas": "#00ABC9", "Bahrain": "#CE1126", "Bangladesh": "#006A4E", "Barbados": "#00267F",
            "Belarus": "#D22730", "Belgium": "#000000", "Belize": "#003F87", "Benin": "#008751", "Bhutan": "#FF4E12",
            "Bolivia": "#007934", "Bosnia and Herzegovina": "#002395", "Botswana": "#75AADB", "Brazil": "#009B3A", "Brunei": "#F7E017",
            "Bulgaria": "#00966E", "Burkina Faso": "#009E49", "Burundi": "#18B637", "CÃ´te d'Ivoire": "#F77F00", "Cabo Verde": "#003893",
            "Cambodia": "#032EA1", "Cameroon": "#007A5E", "Canada": "#D52B1E", "Central African Republic": "#003082", "Chad": "#002664",
            "Chile": "#0039A6", "China": "#DE2910", "Colombia": "#FCD116", "Comoros": "#FF0F00", "Congo (Congo-Brazzaville)": "#009543",
            "Costa Rica": "#002B7F", "Croatia": "#171796", "Cuba": "#002A8F", "Cyprus": "#0033A0", "Czechia (Czech Republic)": "#D7141A",
            "Democratic Republic of the Congo": "#007FFF", "Denmark": "#C60C30", "Djibouti": "#6AB2E7", "Dominica": "#046A38", "Dominican Republic": "#002D62",
            "Ecuador": "#FFD100", "Egypt": "#CE1126", "El Salvador": "#0F47AF", "Equatorial Guinea": "#3E9A00", "Eritrea": "#EA0437",
            "Estonia": "#0072CE", "Eswatini": "#3E5EB9", "Ethiopia": "#078930", "Fiji": "#68BFE5", "Finland": "#002F6C",
            "France": "#0055A4", "Gabon": "#3A75C4", "Gambia": "#CE1126", "Georgia": "#FF0000", "Germany": "#000000",
            "Ghana": "#CE1126", "Greece": "#0D5EAF", "Grenada": "#CE1126", "Guatemala": "#4997D0", "Guinea": "#CE1126",
            "Guinea-Bissau": "#CE1126", "Guyana": "#009E49", "Haiti": "#00209F", "Holy See": "#FFE000", "Honduras": "#0073CF",
            "Hungary": "#436F4D", "Iceland": "#02529C", "India": "#FF9933", "Indonesia": "#CE1126", "Iran": "#DA0000",
            "Iraq": "#CE1126", "Ireland": "#169B62", "Israel": "#0038B8", "Italy": "#009246", "Jamaica": "#000000",
            "Japan": "#BC002D", "Jordan": "#007A3D", "Kazakhstan": "#00AFCA", "Kenya": "#006644", "Kiribati": "#CE1126",
            "Kuwait": "#007A3D", "Kyrgyzstan": "#E8112D", "Laos": "#CE1126", "Latvia": "#9E3039", "Lebanon": "#EE161F",
            "Lesotho": "#00209F", "Liberia": "#BF0A30", "Libya": "#239E46", "Liechtenstein": "#002B7F", "Lithuania": "#006A44",
            "Luxembourg": "#00A1DE", "Madagascar": "#007E3A", "Malawi": "#CE1126", "Malaysia": "#CC0001", "Maldives": "#D21034",
            "Mali": "#CE1126", "Malta": "#CF142B", "Marshall Islands": "#0038A8", "Mauritania": "#006233", "Mauritius": "#EA2839",
            "Mexico": "#006847", "Micronesia": "#75B2DD", "Moldova": "#CC092F", "Monaco": "#CE1126", "Mongolia": "#DA2032",
            "Montenegro": "#D0A650", "Morocco": "#C1272D", "Mozambique": "#009E60", "Myanmar": "#FECB00", "Namibia": "#003580",
            "Nauru": "#FFC72C", "Nepal": "#DC143C", "Netherlands": "#AE1C28", "New Zealand": "#00247D", "Nicaragua": "#0067C6",
            "Niger": "#E05206", "Nigeria": "#008751", "North Korea": "#024FA2", "North Macedonia": "#D20000", "Norway": "#EF2B2D",
            "Oman": "#008000", "Pakistan": "#01411C", "Palau": "#4AADD6", "Panama": "#005293", "Papua New Guinea": "#CE1126",
            "Paraguay": "#0038A8", "Peru": "#D91023", "Philippines": "#0038A8", "Poland": "#DC143C", "Portugal": "#046A38",
            "Qatar": "#8D1B3D", "Romania": "#002B7F", "Russia": "#D52B1E", "Rwanda": "#00A1DE", "Saint Kitts and Nevis": "#CE1126",
            "Saint Lucia": "#65B7E9", "Saint Vincent and the Grenadines": "#009E49", "Samoa": "#CE1126", "San Marino": "#5CBBF5", "Sao Tome and Principe": "#12AD2B",
            "Saudi Arabia": "#245C36", "Senegal": "#00853F", "Serbia": "#C6363C", "Seychelles": "#007A33", "Sierra Leone": "#1EB53A",
            "Singapore": "#ED2939", "Slovakia": "#0B4EA2", "Slovenia": "#0033A0", "Solomon Islands": "#0056B8", "Somalia": "#4189DD",
            "South Africa": "#007A4D", "South Korea": "#003478", "South Sudan": "#078930", "Spain": "#AA151B", "Sri Lanka": "#FFBE29",
            "Sudan": "#D21034", "Suriname": "#377E3F", "Sweden": "#005293", "Switzerland": "#FF0000", "Syria": "#CE1126",
            "Tajikistan": "#CE1126", "Tanzania": "#1EB53A", "Thailand": "#A51931", "Timor-Leste": "#DC241F", "Togo": "#FFCE00",
            "Tonga": "#C10000", "Trinidad and Tobago": "#CE1126", "Tunisia": "#E70013", "Turkey": "#E30A17", "Turkmenistan": "#00843D",
            "Tuvalu": "#00247D", "Uganda": "#FCDD09", "Ukraine": "#0057B8", "United Arab Emirates": "#00732F", "United Kingdom": "#012169",
            "United States": "#3C3B6E", "Uruguay": "#0038A8", "Uzbekistan": "#1EB53A", "Vanuatu": "#FDCC00", "Venezuela": "#FFCC00",
            "Vietnam": "#DA251D", "Yemen": "#CE1126", "Zambia": "#198A00", "Zimbabwe": "#FFD100"
        };

        // Country capital and major cities data
        const COUNTRY_CITIES = {
            "Afghanistan": [
                { lat: 34.5553, lng: 69.2075, name: "Kabul", isCapital: true },
                { lat: 31.6295, lng: 65.7156, name: "Kandahar", isCapital: false },
                { lat: 34.5285, lng: 68.9365, name: "Bamiyan", isCapital: false }
            ],
            "Albania": [
                { lat: 41.3275, lng: 19.8187, name: "Tirana", isCapital: true },
                { lat: 40.4667, lng: 19.4897, name: "VlorÃ«", isCapital: false },
                { lat: 41.1128, lng: 20.0822, name: "Elbasan", isCapital: false }
            ],
            "Algeria": [
                { lat: 36.7538, lng: 3.0588, name: "Algiers", isCapital: true },
                { lat: 35.6971, lng: -0.6337, name: "Oran", isCapital: false },
                { lat: 36.3654, lng: 6.6147, name: "Constantine", isCapital: false }
            ],
            "Andorra": [
                { lat: 42.5063, lng: 1.5218, name: "Andorra la Vella", isCapital: true },
                { lat: 42.5428, lng: 1.5144, name: "Escaldes-Engordany", isCapital: false }
            ],
            "Angola": [
                { lat: -8.8383, lng: 13.2344, name: "Luanda", isCapital: true },
                { lat: -12.3714, lng: 13.5366, name: "Lobito", isCapital: false },
                { lat: -12.8001, lng: 15.7399, name: "Huambo", isCapital: false }
            ],
            "Antigua and Barbuda": [
                { lat: 17.1175, lng: -61.8456, name: "St. John's", isCapital: true }
            ],
            "Argentina": [
                { lat: -34.6037, lng: -58.3816, name: "Buenos Aires", isCapital: true },
                { lat: -31.4167, lng: -64.1833, name: "CÃ³rdoba", isCapital: false },
                { lat: -32.8833, lng: -68.8333, name: "Mendoza", isCapital: false }
            ],
            "Armenia": [
                { lat: 40.1811, lng: 44.5136, name: "Yerevan", isCapital: true },
                { lat: 40.7942, lng: 43.8453, name: "Gyumri", isCapital: false }
            ],
            "Australia": [
                { lat: -35.2809, lng: 149.13, name: "Canberra", isCapital: true },
                { lat: -33.8688, lng: 151.2093, name: "Sydney", isCapital: false },
                { lat: -37.8136, lng: 144.9631, name: "Melbourne", isCapital: false }
            ],
            "Austria": [
                { lat: 48.2082, lng: 16.3738, name: "Vienna", isCapital: true },
                { lat: 47.0707, lng: 15.4395, name: "Graz", isCapital: false },
                { lat: 47.8095, lng: 13.055, name: "Salzburg", isCapital: false }
            ],
            "Azerbaijan": [
                { lat: 40.4093, lng: 49.8671, name: "Baku", isCapital: true },
                { lat: 40.6828, lng: 46.3606, name: "Ganja", isCapital: false }
            ],
            "Bahamas": [
                { lat: 25.0667, lng: -77.3333, name: "Nassau", isCapital: true }
            ],
            "Bahrain": [
                { lat: 26.2235, lng: 50.5876, name: "Manama", isCapital: true }
            ],
            "Bangladesh": [
                { lat: 23.8103, lng: 90.4125, name: "Dhaka", isCapital: true },
                { lat: 22.3569, lng: 91.7832, name: "Chittagong", isCapital: false },
                { lat: 24.374, lng: 88.6011, name: "Rajshahi", isCapital: false }
            ],
            "Barbados": [
                { lat: 13.0975, lng: -59.6167, name: "Bridgetown", isCapital: true }
            ],
            "Belarus": [
                { lat: 53.9045, lng: 27.5615, name: "Minsk", isCapital: true },
                { lat: 52.4345, lng: 30.9754, name: "Gomel", isCapital: false }
            ],
            "Belgium": [
                { lat: 50.8503, lng: 4.3517, name: "Brussels", isCapital: true },
                { lat: 51.2194, lng: 4.4025, name: "Antwerp", isCapital: false },
                { lat: 50.6292, lng: 5.5674, name: "LiÃ¨ge", isCapital: false }
            ],
            "Belize": [
                { lat: 17.251, lng: -88.759, name: "Belmopan", isCapital: true },
                { lat: 17.4986, lng: -88.1886, name: "Belize City", isCapital: false }
            ],
            "Benin": [
                { lat: 6.4969, lng: 2.6289, name: "Porto-Novo", isCapital: true },
                { lat: 6.3725, lng: 2.4256, name: "Cotonou", isCapital: false }
            ],
            "Bhutan": [
                { lat: 27.4728, lng: 89.639, name: "Thimphu", isCapital: true }
            ],
            "Bolivia": [
                { lat: -16.4897, lng: -68.1193, name: "Sucre", isCapital: true },
                { lat: -16.4956, lng: -68.1336, name: "La Paz", isCapital: false },
                { lat: -17.7833, lng: -63.1667, name: "Santa Cruz", isCapital: false }
            ],
            "Bosnia and Herzegovina": [
                { lat: 43.8563, lng: 18.4131, name: "Sarajevo", isCapital: true },
                { lat: 44.7667, lng: 17.1833, name: "Banja Luka", isCapital: false }
            ],
            "Botswana": [
                { lat: -24.6583, lng: 25.9089, name: "Gaborone", isCapital: true },
                { lat: -21.17, lng: 27.5078, name: "Francistown", isCapital: false }
            ],
            "Brazil": [
                { lat: -15.8267, lng: -47.9218, name: "BrasÃ­lia", isCapital: true },
                { lat: -23.5505, lng: -46.6333, name: "SÃ£o Paulo", isCapital: false },
                { lat: -22.9068, lng: -43.1729, name: "Rio de Janeiro", isCapital: false }
            ],
            "Brunei": [
                { lat: 4.9031, lng: 114.9398, name: "Bandar Seri Begawan", isCapital: true }
            ],
            "Bulgaria": [
                { lat: 42.6977, lng: 23.3219, name: "Sofia", isCapital: true },
                { lat: 42.1354, lng: 24.7453, name: "Plovdiv", isCapital: false }
            ],
            "Burkina Faso": [
                { lat: 12.3714, lng: -1.5197, name: "Ouagadougou", isCapital: true },
                { lat: 12.3958, lng: -1.5214, name: "Bobo-Dioulasso", isCapital: false }
            ],
            "Burundi": [
                { lat: -3.3822, lng: 29.3644, name: "Gitega", isCapital: true },
                { lat: -3.4287, lng: 29.9309, name: "Bujumbura", isCapital: false }
            ],
            "CÃ´te d'Ivoire": [
                { lat: 5.3544, lng: -4.0017, name: "Abidjan", isCapital: false },
                { lat: 6.8206, lng: -5.2767, name: "Yamoussoukro", isCapital: true }
            ],
            "Cabo Verde": [
                { lat: 14.9333, lng: -23.5167, name: "Praia", isCapital: true }
            ],
            "Cambodia": [
                { lat: 11.5564, lng: 104.9282, name: "Phnom Penh", isCapital: true },
                { lat: 13.3617, lng: 103.8606, name: "Siem Reap", isCapital: false }
            ],
            "Cameroon": [
                { lat: 3.848, lng: 11.5021, name: "YaoundÃ©", isCapital: true },
                { lat: 4.0511, lng: 9.7679, name: "Douala", isCapital: false }
            ],
            "Canada": [
                { lat: 45.4215, lng: -75.6972, name: "Ottawa", isCapital: true },
                { lat: 43.6532, lng: -79.3832, name: "Toronto", isCapital: false },
                { lat: 49.2827, lng: -123.1207, name: "Vancouver", isCapital: false }
            ],
            "Central African Republic": [
                { lat: 4.3947, lng: 18.5582, name: "Bangui", isCapital: true }
            ],
            "Chad": [
                { lat: 12.1348, lng: 15.0557, name: "N'Djamena", isCapital: true }
            ],
            "Chile": [
                { lat: -33.4489, lng: -70.6693, name: "Santiago", isCapital: true },
                { lat: -33.0245, lng: -71.5518, name: "ValparaÃ­so", isCapital: false }
            ],
            "China": [
                { lat: 39.9042, lng: 116.4074, name: "Beijing", isCapital: true },
                { lat: 31.2304, lng: 121.4737, name: "Shanghai", isCapital: false },
                { lat: 23.1291, lng: 113.2644, name: "Guangzhou", isCapital: false }
            ],
            "Colombia": [
                { lat: 4.711, lng: -74.0721, name: "BogotÃ¡", isCapital: true },
                { lat: 6.2442, lng: -75.5812, name: "MedellÃ­n", isCapital: false },
                { lat: 10.9639, lng: -74.7964, name: "Barranquilla", isCapital: false }
            ],
            "Comoros": [
                { lat: -11.7172, lng: 43.2473, name: "Moroni", isCapital: true }
            ],
            "Congo (Congo-Brazzaville)": [
                { lat: -4.2634, lng: 15.2429, name: "Brazzaville", isCapital: true },
                { lat: -4.7692, lng: 11.8664, name: "Pointe-Noire", isCapital: false }
            ],
            "Costa Rica": [
                { lat: 9.9281, lng: -84.0907, name: "San JosÃ©", isCapital: true }
            ],
            "Croatia": [
                { lat: 45.815, lng: 15.9819, name: "Zagreb", isCapital: true },
                { lat: 43.5089, lng: 16.4392, name: "Split", isCapital: false }
            ],
            "Cuba": [
                { lat: 23.1136, lng: -82.3666, name: "Havana", isCapital: true },
                { lat: 20.0217, lng: -75.8294, name: "Santiago de Cuba", isCapital: false }
            ],
            "Cyprus": [
                { lat: 35.1856, lng: 33.3823, name: "Nicosia", isCapital: true },
                { lat: 34.675, lng: 33.0443, name: "Limassol", isCapital: false }
            ],
            "Czechia (Czech Republic)": [
                { lat: 50.0755, lng: 14.4378, name: "Prague", isCapital: true },
                { lat: 49.1951, lng: 16.6068, name: "Brno", isCapital: false }
            ],
            "Democratic Republic of the Congo": [
                { lat: -4.4419, lng: 15.2663, name: "Kinshasa", isCapital: true },
                { lat: -11.6647, lng: 27.4796, name: "Lubumbashi", isCapital: false }
            ],
            "Denmark": [
                { lat: 55.6761, lng: 12.5683, name: "Copenhagen", isCapital: true },
                { lat: 56.1629, lng: 10.2039, name: "Aarhus", isCapital: false }
            ],
            "Djibouti": [
                { lat: 11.5721, lng: 43.1456, name: "Djibouti", isCapital: true }
            ],
            "Dominica": [
                { lat: 15.3092, lng: -61.379, name: "Roseau", isCapital: true }
            ],
            "Dominican Republic": [
                { lat: 18.4861, lng: -69.9312, name: "Santo Domingo", isCapital: true },
                { lat: 19.4579, lng: -70.6886, name: "Santiago", isCapital: false }
            ],
            "Ecuador": [
                { lat: -0.2295, lng: -78.5249, name: "Quito", isCapital: true },
                { lat: -2.1708, lng: -79.9224, name: "Guayaquil", isCapital: false }
            ],
            "Egypt": [
                { lat: 30.0444, lng: 31.2357, name: "Cairo", isCapital: true },
                { lat: 31.2001, lng: 29.9187, name: "Alexandria", isCapital: false }
            ],
            "El Salvador": [
                { lat: 13.6929, lng: -89.2182, name: "San Salvador", isCapital: true }
            ],
            "Equatorial Guinea": [
                { lat: 3.7523, lng: 8.7741, name: "Malabo", isCapital: true }
            ],
            "Eritrea": [
                { lat: 15.3229, lng: 38.9251, name: "Asmara", isCapital: true }
            ],
            "Estonia": [
                { lat: 59.437, lng: 24.7536, name: "Tallinn", isCapital: true },
                { lat: 58.378, lng: 26.729, name: "Tartu", isCapital: false }
            ],
            "Eswatini": [
                { lat: -26.3054, lng: 31.1367, name: "Mbabane", isCapital: true },
                { lat: -26.4833, lng: 31.3667, name: "Manzini", isCapital: false }
            ],
            "Ethiopia": [
                { lat: 9.032, lng: 38.7496, name: "Addis Ababa", isCapital: true },
                { lat: 8.9806, lng: 38.7578, name: "Dire Dawa", isCapital: false }
            ],
            "Fiji": [
                { lat: -18.1248, lng: 178.4501, name: "Suva", isCapital: true }
            ],
            "Finland": [
                { lat: 60.1699, lng: 24.9384, name: "Helsinki", isCapital: true },
                { lat: 61.4981, lng: 23.761, name: "Tampere", isCapital: false }
            ],
            "France": [
                { lat: 48.8566, lng: 2.3522, name: "Paris", isCapital: true },
                { lat: 43.2965, lng: 5.3698, name: "Marseille", isCapital: false },
                { lat: 45.764, lng: 4.8357, name: "Lyon", isCapital: false }
            ],
            "Gabon": [
                { lat: 0.3901, lng: 9.4544, name: "Libreville", isCapital: true }
            ],
            "Gambia": [
                { lat: 13.4549, lng: -16.579, name: "Banjul", isCapital: true }
            ],
            "Georgia": [
                { lat: 41.7151, lng: 44.8271, name: "Tbilisi", isCapital: true },
                { lat: 42.25, lng: 42.7, name: "Kutaisi", isCapital: false }
            ],
            "Germany": [
                { lat: 52.52, lng: 13.405, name: "Berlin", isCapital: true },
                { lat: 48.1351, lng: 11.582, name: "Munich", isCapital: false },
                { lat: 50.9375, lng: 6.9603, name: "Cologne", isCapital: false }
            ],
            "Ghana": [
                { lat: 5.6037, lng: -0.187, name: "Accra", isCapital: true },
                { lat: 6.6736, lng: -1.5714, name: "Kumasi", isCapital: false }
            ],
            "Greece": [
                { lat: 37.9838, lng: 23.7275, name: "Athens", isCapital: true },
                { lat: 40.6401, lng: 22.9444, name: "Thessaloniki", isCapital: false }
            ],
            "Grenada": [
                { lat: 12.0561, lng: -61.7486, name: "St. George's", isCapital: true }
            ],
            "Guatemala": [
                { lat: 14.6349, lng: -90.5069, name: "Guatemala City", isCapital: true }
            ],
            "Guinea": [
                { lat: 9.6412, lng: -13.5784, name: "Conakry", isCapital: true }
            ],
            "Guinea-Bissau": [
                { lat: 11.8636, lng: -15.5846, name: "Bissau", isCapital: true }
            ],
            "Guyana": [
                { lat: 6.8013, lng: -58.1553, name: "Georgetown", isCapital: true }
            ],
            "Haiti": [
                { lat: 18.5944, lng: -72.3074, name: "Port-au-Prince", isCapital: true }
            ],
            "Holy See": [
                { lat: 41.9029, lng: 12.4534, name: "Vatican City", isCapital: true }
            ],
            "Honduras": [
                { lat: 14.0723, lng: -87.1921, name: "Tegucigalpa", isCapital: true }
            ],
            "Hungary": [
                { lat: 47.4979, lng: 19.0402, name: "Budapest", isCapital: true },
                { lat: 47.5316, lng: 21.6273, name: "Debrecen", isCapital: false }
            ],
            "Iceland": [
                { lat: 64.1466, lng: -21.9426, name: "Reykjavik", isCapital: true }
            ],
            "India": [
                { lat: 28.6139, lng: 77.209, name: "New Delhi", isCapital: true },
                { lat: 19.076, lng: 72.8777, name: "Mumbai", isCapital: false },
                { lat: 13.0827, lng: 80.2707, name: "Chennai", isCapital: false }
            ],
            "Indonesia": [
                { lat: -6.2088, lng: 106.8456, name: "Jakarta", isCapital: true },
                { lat: -7.2575, lng: 112.7521, name: "Surabaya", isCapital: false }
            ],
            "Iran": [
                { lat: 35.6892, lng: 51.389, name: "Tehran", isCapital: true },
                { lat: 32.6539, lng: 51.666, name: "Isfahan", isCapital: false }
            ],
            "Iraq": [
                { lat: 33.3152, lng: 44.3661, name: "Baghdad", isCapital: true },
                { lat: 36.1911, lng: 44.0092, name: "Erbil", isCapital: false }
            ],
            "Ireland": [
                { lat: 53.3498, lng: -6.2603, name: "Dublin", isCapital: true },
                { lat: 51.8985, lng: -8.4756, name: "Cork", isCapital: false }
            ],
            "Israel": [
                { lat: 31.7683, lng: 35.2137, name: "Jerusalem", isCapital: true },
                { lat: 32.0853, lng: 34.7818, name: "Tel Aviv", isCapital: false }
            ],
            "Italy": [
                { lat: 41.9028, lng: 12.4964, name: "Rome", isCapital: true },
                { lat: 45.4642, lng: 9.19, name: "Milan", isCapital: false },
                { lat: 40.8518, lng: 14.2681, name: "Naples", isCapital: false }
            ],
            "Jamaica": [
                { lat: 17.9714, lng: -76.7926, name: "Kingston", isCapital: true },
                { lat: 18.0179, lng: -76.8099, name: "Montego Bay", isCapital: false }
            ],
            "Japan": [
                { lat: 35.6762, lng: 139.6503, name: "Tokyo", isCapital: true },
                { lat: 34.6937, lng: 135.5023, name: "Osaka", isCapital: false },
                { lat: 35.0116, lng: 135.7681, name: "Kyoto", isCapital: false }
            ],
            "Jordan": [
                { lat: 31.9454, lng: 35.9284, name: "Amman", isCapital: true }
            ],
            "Kazakhstan": [
                { lat: 51.1605, lng: 71.4704, name: "Nur-Sultan", isCapital: true },
                { lat: 43.2389, lng: 76.8897, name: "Almaty", isCapital: false }
            ],
            "Kenya": [
                { lat: -1.2921, lng: 36.8219, name: "Nairobi", isCapital: true },
                { lat: -0.1022, lng: 34.7617, name: "Kisumu", isCapital: false }
            ],
            "Kiribati": [
                { lat: 1.4518, lng: 172.9717, name: "South Tarawa", isCapital: true }
            ],
            "Kuwait": [
                { lat: 29.3759, lng: 47.9774, name: "Kuwait City", isCapital: true }
            ],
            "Kyrgyzstan": [
                { lat: 42.8746, lng: 74.5698, name: "Bishkek", isCapital: true }
            ],
            "Laos": [
                { lat: 17.9757, lng: 102.6331, name: "Vientiane", isCapital: true }
            ],
            "Latvia": [
                { lat: 56.9496, lng: 24.1052, name: "Riga", isCapital: true }
            ],
            "Lebanon": [
                { lat: 33.8938, lng: 35.5018, name: "Beirut", isCapital: true }
            ],
            "Lesotho": [
                { lat: -29.31, lng: 27.48, name: "Maseru", isCapital: true }
            ],
            "Liberia": [
                { lat: 6.3008, lng: -10.7972, name: "Monrovia", isCapital: true }
            ],
            "Libya": [
                { lat: 32.8872, lng: 13.1913, name: "Tripoli", isCapital: true }
            ],
            "Liechtenstein": [
                { lat: 47.141, lng: 9.5209, name: "Vaduz", isCapital: true }
            ],
            "Lithuania": [
                { lat: 54.6872, lng: 25.2797, name: "Vilnius", isCapital: true },
                { lat: 54.8985, lng: 23.9036, name: "Kaunas", isCapital: false }
            ],
            "Luxembourg": [
                { lat: 49.6116, lng: 6.1319, name: "Luxembourg", isCapital: true }
            ],
            "Madagascar": [
                { lat: -18.8792, lng: 47.5079, name: "Antananarivo", isCapital: true }
            ],
            "Malawi": [
                { lat: -13.9626, lng: 33.7741, name: "Lilongwe", isCapital: true },
                { lat: -15.7861, lng: 35.0058, name: "Blantyre", isCapital: false }
            ],
            "Malaysia": [
                { lat: 3.139, lng: 101.6869, name: "Kuala Lumpur", isCapital: true },
                { lat: 1.3521, lng: 103.8198, name: "Singapore", isCapital: false }
            ],
            "Maldives": [
                { lat: 4.1755, lng: 73.5093, name: "MalÃ©", isCapital: true }
            ],
            "Mali": [
                { lat: 12.6392, lng: -8.0029, name: "Bamako", isCapital: true }
            ],
            "Malta": [
                { lat: 35.8989, lng: 14.5146, name: "Valletta", isCapital: true }
            ],
            "Marshall Islands": [
                { lat: 7.0897, lng: 171.3803, name: "Majuro", isCapital: true }
            ],
            "Mauritania": [
                { lat: 18.0731, lng: -15.9582, name: "Nouakchott", isCapital: true }
            ],
            "Mauritius": [
                { lat: -20.1609, lng: 57.5012, name: "Port Louis", isCapital: true }
            ],
            "Mexico": [
                { lat: 19.4326, lng: -99.1332, name: "Mexico City", isCapital: true },
                { lat: 20.6597, lng: -103.3496, name: "Guadalajara", isCapital: false }
            ],
            "Micronesia": [
                { lat: 6.9248, lng: 158.1618, name: "Palikir", isCapital: true }
            ],
            "Moldova": [
                { lat: 47.0105, lng: 28.8638, name: "ChiÈ™inÄƒu", isCapital: true }
            ],
            "Monaco": [
                { lat: 43.7384, lng: 7.4246, name: "Monaco", isCapital: true }
            ],
            "Mongolia": [
                { lat: 47.8864, lng: 106.9057, name: "Ulaanbaatar", isCapital: true }
            ],
            "Montenegro": [
                { lat: 42.4304, lng: 19.2594, name: "Podgorica", isCapital: true }
            ],
            "Morocco": [
                { lat: 34.0209, lng: -6.8416, name: "Rabat", isCapital: true },
                { lat: 33.9716, lng: -6.8498, name: "Casablanca", isCapital: false }
            ],
            "Mozambique": [
                { lat: -25.9667, lng: 32.5833, name: "Maputo", isCapital: true }
            ],
            "Myanmar": [
                { lat: 16.8409, lng: 96.1735, name: "Yangon", isCapital: false },
                { lat: 19.7633, lng: 96.0785, name: "Naypyidaw", isCapital: true }
            ],
            "Namibia": [
                { lat: -22.5609, lng: 17.0658, name: "Windhoek", isCapital: true }
            ],
            "Nauru": [
                { lat: -0.5477, lng: 166.9209, name: "Yaren", isCapital: true }
            ],
            "Nepal": [
                { lat: 27.7172, lng: 85.324, name: "Kathmandu", isCapital: true }
            ],
            "Netherlands": [
                { lat: 52.3676, lng: 4.9041, name: "Amsterdam", isCapital: true },
                { lat: 51.9244, lng: 4.4777, name: "Rotterdam", isCapital: false }
            ],
            "New Zealand": [
                { lat: -41.2865, lng: 174.7762, name: "Wellington", isCapital: true },
                { lat: -36.8485, lng: 174.7633, name: "Auckland", isCapital: false }
            ],
            "Nicaragua": [
                { lat: 12.1364, lng: -86.2514, name: "Managua", isCapital: true }
            ],
            "Niger": [
                { lat: 13.5127, lng: 2.1125, name: "Niamey", isCapital: true }
            ],
            "Nigeria": [
                { lat: 9.0579, lng: 7.4951, name: "Abuja", isCapital: true },
                { lat: 6.5244, lng: 3.3792, name: "Lagos", isCapital: false }
            ],
            "North Korea": [
                { lat: 39.0392, lng: 125.7625, name: "Pyongyang", isCapital: true }
            ],
            "North Macedonia": [
                { lat: 42.004, lng: 21.4366, name: "Skopje", isCapital: true }
            ],
            "Norway": [
                { lat: 59.9139, lng: 10.7522, name: "Oslo", isCapital: true },
                { lat: 60.3913, lng: 5.3221, name: "Bergen", isCapital: false }
            ],
            "Oman": [
                { lat: 23.588, lng: 58.3829, name: "Muscat", isCapital: true }
            ],
            "Pakistan": [
                { lat: 33.6844, lng: 73.0479, name: "Islamabad", isCapital: true },
                { lat: 24.8607, lng: 67.0011, name: "Karachi", isCapital: false }
            ],
            "Palau": [
                { lat: 7.5149, lng: 134.5825, name: "Ngerulmud", isCapital: true }
            ],
            "Panama": [
                { lat: 8.9824, lng: -79.5199, name: "Panama City", isCapital: true }
            ],
            "Papua New Guinea": [
                { lat: -9.4783, lng: 147.1502, name: "Port Moresby", isCapital: true }
            ],
            "Paraguay": [
                { lat: -25.2637, lng: -57.5759, name: "AsunciÃ³n", isCapital: true }
            ],
            "Peru": [
                { lat: -12.0464, lng: -77.0428, name: "Lima", isCapital: true },
                { lat: -13.5319, lng: -71.9675, name: "Cusco", isCapital: false }
            ],
            "Philippines": [
                { lat: 14.5995, lng: 120.9842, name: "Manila", isCapital: true },
                { lat: 10.3157, lng: 123.8854, name: "Cebu City", isCapital: false }
            ],
            "Poland": [
                { lat: 52.2297, lng: 21.0122, name: "Warsaw", isCapital: true },
                { lat: 50.0647, lng: 19.945, name: "KrakÃ³w", isCapital: false }
            ],
            "Portugal": [
                { lat: 38.7223, lng: -9.1393, name: "Lisbon", isCapital: true },
                { lat: 41.1579, lng: -8.6291, name: "Porto", isCapital: false }
            ],
            "Qatar": [
                { lat: 25.2769, lng: 51.52, name: "Doha", isCapital: true }
            ],
            "Romania": [
                { lat: 44.4268, lng: 26.1025, name: "Bucharest", isCapital: true },
                { lat: 46.7712, lng: 23.6236, name: "Cluj-Napoca", isCapital: false }
            ],
            "Russia": [
                { lat: 55.7558, lng: 37.6173, name: "Moscow", isCapital: true },
                { lat: 59.9343, lng: 30.3351, name: "Saint Petersburg", isCapital: false }
            ],
            "Rwanda": [
                { lat: -1.9501, lng: 30.0588, name: "Kigali", isCapital: true }
            ],
            "Saint Kitts and Nevis": [
                { lat: 17.3026, lng: -62.7177, name: "Basseterre", isCapital: true }
            ],
            "Saint Lucia": [
                { lat: 14.0101, lng: -60.9875, name: "Castries", isCapital: true }
            ],
            "Saint Vincent and the Grenadines": [
                { lat: 13.1600, lng: -61.2246, name: "Kingstown", isCapital: true }
            ],
            "Samoa": [
                { lat: -13.8333, lng: -171.7667, name: "Apia", isCapital: true }
            ],
            "San Marino": [
                { lat: 43.9424, lng: 12.4578, name: "San Marino", isCapital: true }
            ],
            "Sao Tome and Principe": [
                { lat: 0.3365, lng: 6.7274, name: "SÃ£o TomÃ©", isCapital: true }
            ],
            "Saudi Arabia": [
                { lat: 24.7136, lng: 46.6753, name: "Riyadh", isCapital: true },
                { lat: 21.3891, lng: 39.8579, name: "Mecca", isCapital: false }
            ],
            "Senegal": [
                { lat: 14.7167, lng: -17.4677, name: "Dakar", isCapital: true }
            ],
            "Serbia": [
                { lat: 44.8206, lng: 20.4622, name: "Belgrade", isCapital: true }
            ],
            "Seychelles": [
                { lat: -4.6203, lng: 55.4514, name: "Victoria", isCapital: true }
            ],
            "Sierra Leone": [
                { lat: 8.484, lng: -13.2299, name: "Freetown", isCapital: true }
            ],
            "Singapore": [
                { lat: 1.3521, lng: 103.8198, name: "Singapore", isCapital: true }
            ],
            "Slovakia": [
                { lat: 48.1486, lng: 17.1077, name: "Bratislava", isCapital: true }
            ],
            "Slovenia": [
                { lat: 46.0569, lng: 14.5058, name: "Ljubljana", isCapital: true }
            ],
            "Solomon Islands": [
                { lat: -9.4333, lng: 159.95, name: "Honiara", isCapital: true }
            ],
            "Somalia": [
                { lat: 2.0408, lng: 45.3425, name: "Mogadishu", isCapital: true }
            ],
            "South Africa": [
                { lat: -25.7461, lng: 28.1881, name: "Pretoria", isCapital: true },
                { lat: -33.9249, lng: 18.4241, name: "Cape Town", isCapital: false }
            ],
            "South Korea": [
                { lat: 37.5665, lng: 126.978, name: "Seoul", isCapital: true },
                { lat: 35.1796, lng: 129.0756, name: "Busan", isCapital: false }
            ],
            "South Sudan": [
                { lat: 4.85, lng: 31.6, name: "Juba", isCapital: true }
            ],
            "Spain": [
                { lat: 40.4168, lng: -3.7038, name: "Madrid", isCapital: true },
                { lat: 41.3851, lng: 2.1734, name: "Barcelona", isCapital: false }
            ],
            "Sri Lanka": [
                { lat: 6.9271, lng: 79.8612, name: "Colombo", isCapital: true },
                { lat: 7.8731, lng: 80.7718, name: "Kandy", isCapital: false }
            ],
            "Sudan": [
                { lat: 15.5007, lng: 32.5599, name: "Khartoum", isCapital: true }
            ],
            "Suriname": [
                { lat: 5.852, lng: -55.2038, name: "Paramaribo", isCapital: true }
            ],
            "Sweden": [
                { lat: 59.3293, lng: 18.0686, name: "Stockholm", isCapital: true },
                { lat: 57.7089, lng: 11.9746, name: "Gothenburg", isCapital: false }
            ],
            "Switzerland": [
                { lat: 46.948, lng: 7.4474, name: "Bern", isCapital: true },
                { lat: 47.3769, lng: 8.5417, name: "Zurich", isCapital: false }
            ],
            "Syria": [
                { lat: 33.5138, lng: 36.2765, name: "Damascus", isCapital: true },
                { lat: 36.2021, lng: 37.1343, name: "Aleppo", isCapital: false }
            ],
            "Tajikistan": [
                { lat: 38.5598, lng: 68.787, name: "Dushanbe", isCapital: true }
            ],
            "Tanzania": [
                { lat: -6.7924, lng: 39.2083, name: "Dar es Salaam", isCapital: false },
                { lat: -6.1630, lng: 35.7516, name: "Dodoma", isCapital: true }
            ],
            "Thailand": [
                { lat: 13.7563, lng: 100.5018, name: "Bangkok", isCapital: true },
                { lat: 18.7061, lng: 98.9817, name: "Chiang Mai", isCapital: false }
            ],
            "Timor-Leste": [
                { lat: -8.5569, lng: 125.5603, name: "Dili", isCapital: true }
            ],
            "Togo": [
                { lat: 6.1725, lng: 1.2314, name: "LomÃ©", isCapital: true }
            ],
            "Tonga": [
                { lat: -21.1393, lng: -175.2049, name: "Nuku'alofa", isCapital: true }
            ],
            "Trinidad and Tobago": [
                { lat: 10.6549, lng: -61.5019, name: "Port of Spain", isCapital: true }
            ],
            "Tunisia": [
                { lat: 36.8065, lng: 10.1815, name: "Tunis", isCapital: true }
            ],
            "Turkey": [
                { lat: 39.9334, lng: 32.8597, name: "Ankara", isCapital: true },
                { lat: 41.0082, lng: 28.9784, name: "Istanbul", isCapital: false }
            ],
            "Turkmenistan": [
                { lat: 37.9601, lng: 58.3261, name: "Ashgabat", isCapital: true }
            ],
            "Tuvalu": [
                { lat: -8.5167, lng: 179.2167, name: "Funafuti", isCapital: true }
            ],
            "Uganda": [
                { lat: 0.3136, lng: 32.5811, name: "Kampala", isCapital: true }
            ],
            "Ukraine": [
                { lat: 50.4501, lng: 30.5234, name: "Kyiv", isCapital: true },
                { lat: 49.8397, lng: 24.0297, name: "Lviv", isCapital: false }
            ],
            "United Arab Emirates": [
                { lat: 24.4539, lng: 54.3773, name: "Abu Dhabi", isCapital: true },
                { lat: 25.2048, lng: 55.2708, name: "Dubai", isCapital: false }
            ],
            "United Kingdom": [
                { lat: 51.5074, lng: -0.1278, name: "London", isCapital: true },
                { lat: 55.9533, lng: -3.1883, name: "Edinburgh", isCapital: false }
            ],
            "United States": [
                { lat: 38.9072, lng: -77.0369, name: "Washington, D.C.", isCapital: true },
                { lat: 40.7128, lng: -74.006, name: "New York", isCapital: false },
                { lat: 34.0522, lng: -118.2437, name: "Los Angeles", isCapital: false }
            ],
            "Uruguay": [
                { lat: -34.9011, lng: -56.1645, name: "Montevideo", isCapital: true }
            ],
            "Uzbekistan": [
                { lat: 41.2995, lng: 69.2401, name: "Tashkent", isCapital: true },
                { lat: 39.627, lng: 66.975, name: "Samarkand", isCapital: false }
            ],
            "Vanuatu": [
                { lat: -17.7333, lng: 168.3167, name: "Port Vila", isCapital: true }
            ],
            "Venezuela": [
                { lat: 10.4806, lng: -66.9036, name: "Caracas", isCapital: true }
            ],
            "Vietnam": [
                { lat: 21.0278, lng: 105.8342, name: "Hanoi", isCapital: true },
                { lat: 10.8231, lng: 106.6297, name: "Ho Chi Minh City", isCapital: false }
            ],
            "Yemen": [
                { lat: 15.3694, lng: 44.191, name: "Sana'a", isCapital: true }
            ],
            "Zambia": [
                { lat: -15.4167, lng: 28.2833, name: "Lusaka", isCapital: true }
            ],
            "Zimbabwe": [
                { lat: -17.8292, lng: 31.0522, name: "Harare", isCapital: true }
            ]
        };

        // Game state
        const gameState = {
            player: {
                name: "Commander",
                nation: null,
                stats: { cities: 0, units: 0, techs: 0 }
            },
            selectedNation: null
        };
        
        let map;
        let countryLayers;
        let selectedCountryLayer = null;
        
        function initMap() {
            document.getElementById('loading-spinner').style.display = 'flex';
            
            map = L.map('map-container', {
                center: [20, 0], zoom: 2, maxZoom: 18, minZoom: 2,
                worldCopyJump: true, tap: false, preferCanvas: true
            });

            const tiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd', maxZoom: 20, noWrap: true,
                errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='
            }).addTo(map);

            tiles.on('tileerror', function(error) { console.log('Tile loading error:', error); });

            loadCountryData();
        }

        function loadCountryData() {
            fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to load country data');
                    return response.json();
                })
                .then(data => {
                    processCountryData(data);
                    document.getElementById('loading-spinner').style.display = 'none';
                    initializeGame();
                })
                .catch(error => {
                    console.error("Error loading country data:", error);
                    showLoadingError();
                });
        }

        function processCountryData(data) {
            // Include all countries now
            countryLayers = L.geoJson(data, {
                style: getCountryStyle,
                onEachFeature: onEachCountryFeature
            }).addTo(map);
        }

        function getCountryStyle(feature) {
            const countryName = feature.properties.name;
            const isSelected = selectedCountryLayer && selectedCountryLayer.feature.id === feature.id;

            let fillColor, color, weight;

            if (isSelected) {
                fillColor = NATION_COLORS[countryName] || '#00aaff';
                color = 'white';
                weight = 3;
            } else {
                fillColor = NATION_COLORS[countryName] || '#2c2c2c';
                color = '#4a4a4a';
                weight = 1;
            }

            return {
                fillColor: fillColor, weight: weight, opacity: 1, color: color,
                fillOpacity: 0.8, interactive: true
            };
        }

        function onEachCountryFeature(feature, layer) {
            const countryName = feature.properties.name;
            layer.bindTooltip(countryName, { permanent: false, direction: 'auto', className: 'country-tooltip' });
            layer.on({
                click: (e) => handleCountryClick(e, layer, countryName),
                mouseover: (e) => highlightCountry(e.target, countryName),
                mouseout: (e) => resetCountryHighlight(e.target)
            });
        }

        function handleCountryClick(e, layer, countryName) {
            L.DomEvent.stop(e);
            selectCountry(layer, countryName);
        }

        function highlightCountry(layer, countryName) {
            if (layer === selectedCountryLayer) return;
            
            layer.setStyle({ 
                weight: 2, 
                color: '#e0e0e0', 
                fillOpacity: 0.9 
            });
            layer.bringToFront();
            
            showCountryPreview(countryName);
        }

        function resetCountryHighlight(layer) {
            if (layer === selectedCountryLayer) return;
            countryLayers.resetStyle(layer);
            hideCountryPreview();
        }

        function selectCountry(layer, countryName) {
            gameState.selectedNation = countryName;
            const previouslySelectedLayer = selectedCountryLayer;
            selectedCountryLayer = layer;

            if (previouslySelectedLayer && previouslySelectedLayer !== layer) {
                countryLayers.resetStyle(previouslySelectedLayer);
            }

            layer.setStyle(getCountryStyle(layer.feature));
            layer.bringToFront();

            document.getElementById('selected-nation-display').textContent = countryName;
            document.getElementById('start-game-btn').disabled = false;
            document.getElementById('selection-instructions').style.display = 'none';
            
            showCountryDetails(countryName);
        }

        function showCountryPreview(countryName) {
            const panel = document.getElementById('nation-details-panel');
            const flag = NATION_FLAGS[countryName] || 'ðŸ³ï¸';
            
            document.getElementById('nation-details-name').textContent = countryName;
            document.getElementById('nation-details-flag').textContent = flag;
            
            document.getElementById('nation-details-population').textContent = 
                `Population: ${(Math.random() * 100 + 5).toFixed(1)}M`;
            document.getElementById('nation-details-gdp').textContent = 
                `GDP: $${(Math.random() * 500 + 50).toFixed(1)}B`;
            document.getElementById('nation-details-military').textContent = 
                `Military: ${Math.floor(Math.random() * 500 + 50)}K`;
            
            panel.style.display = 'block';
            panel.style.opacity = '0.8';
        }

        function showCountryDetails(countryName) {
            const panel = document.getElementById('nation-details-panel');
            const flag = NATION_FLAGS[countryName] || 'ðŸ³ï¸';
            
            document.getElementById('nation-details-name').textContent = countryName;
            document.getElementById('nation-details-flag').textContent = flag;
            
            document.getElementById('nation-details-population').textContent = 
                `Population: ${(Math.random() * 100 + 5).toFixed(1)}M`;
            document.getElementById('nation-details-gdp').textContent = 
                `GDP: $${(Math.random() * 500 + 50).toFixed(1)}B`;
            document.getElementById('nation-details-military').textContent = 
                `Military: ${Math.floor(Math.random() * 500 + 50)}K`;
            
            panel.style.display = 'block';
            panel.style.opacity = '1';
        }

        function hideCountryPreview() {
            if (!selectedCountryLayer) {
                document.getElementById('nation-details-panel').style.display = 'none';
            }
        }

        function showLoadingError() {
            document.getElementById('loading-spinner').innerHTML = `<div style="text-align:center;color:red;background:rgba(0,0,0,0.7);padding:20px;border-radius:10px;">Failed to load map data. Please check your network connection and refresh.<button onclick="window.location.reload()" style="margin-top:10px;padding:5px 10px;background:var(--accent-color);border:none;border-radius:5px;cursor:pointer;">Retry</button></div>`;
        }

        function startGame() {
            if (!gameState.selectedNation) return;
            
            // Set the player's nation
            gameState.player.nation = gameState.selectedNation;
            
            // Store the selected nation in localStorage
            localStorage.setItem('selectedNation', gameState.player.nation);
            
            // Redirect to command center
            window.location.href = 'command-center/command.html';
        }

        function initializeGame() {
            document.getElementById('start-game-btn').addEventListener('click', startGame);
            
            // Check for previously selected nation
            const savedNation = localStorage.getItem('selectedNation');
            if (savedNation) {
                // Find and select the saved nation
                countryLayers.eachLayer(layer => {
                    if (layer.feature.properties.name === savedNation) {
                        selectCountry(layer, savedNation);
                        showCountryDetails(savedNation);
                    }
                });
            }
        }

        // Modal functions
        function showModal(text, buttons) {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-text').textContent = text;
            const buttonsContainer = document.getElementById('modal-buttons');
            buttonsContainer.innerHTML = '';

            buttons.forEach(btnInfo => {
                const button = document.createElement('button');
                button.textContent = btnInfo.text;
                button.className = `modal-button ${btnInfo.class}`;
                button.addEventListener('click', () => {
                    modal.style.display = 'none';
                    if (btnInfo.callback) {
                        btnInfo.callback();
                    }
                }, { once: true });
                buttonsContainer.appendChild(button);
            });

            modal.style.display = 'flex';
        }

        function showConfirmation(text, onConfirm) {
            showModal(text, [
                { text: 'Yes', class: 'modal-confirm', callback: onConfirm },
                { text: 'No', class: 'modal-cancel', callback: null }
            ]);
        }

        function showAlert(text) {
            showModal(text, [{ text: 'OK', class: 'modal-confirm', callback: null }]);
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>